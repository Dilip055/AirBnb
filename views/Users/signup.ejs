<% layout('/layouts/boilerplate.ejs') -%>
<body class="bg-light">
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card shadow-lg">
          <div class="card-body p-5">
            <h2 class="text-center mb-4">Create Your Airbnb Account</h2>
            <form id="signupForm" action="/users/register" method="POST" enctype="multipart/form-data" novalidate>
              
              <!-- Avatar Upload -->
              <div class="mb-3 text-center">
                <div class="avatar-upload">
                  <div class="avatar-edit mb-2">
                    <input type="file" id="imageUpload" name="profileImage" accept=".png, .jpg, .jpeg" required>
                    <label for="imageUpload" class="btn btn-outline-secondary btn-sm"></label>
                  </div>
                  <div class="avatar-preview">
                    <div id="imagePreview" style="width: 124px; height: 124px; border-radius: 50%; background-size: cover; background-position: center; background-color: #f8f9fa; margin: 2px auto; background-image: url(https://img.freepik.com/premium-vector/vector-flat-illustration-grayscale-avatar-user-profile-person-icon-profile-picture-business-profile-woman-suitable-social-media-profiles-icons-screensavers-as-templatex9_719432-1339.jpg?semt=ais_items_boosted&w=740);"></div>
                  </div>
                </div>
              </div>

              <!-- Username -->
              <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" name="username" class="form-control" id="username" placeholder="Choose a username" required minlength="3">
                <div class="invalid-feedback">Username must be at least 3 characters long.</div>
              </div>

              <!-- Email -->
              <div class="mb-3">
                <label for="email" class="form-label">Email address</label>
                <input type="email" name="email" class="form-control" id="email" placeholder="you@example.com" required>
                <div class="invalid-feedback">Enter a valid email address.</div>
              </div>

              <!-- Password -->
              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" name="password" class="form-control" id="password" placeholder="Create a password" required minlength="6">
                <div class="invalid-feedback">Password must be at least 6 characters long.</div>
              </div>

              <button type="submit" class="btn btn-danger w-100">Sign Up</button>
              <p class="mt-3 text-center">Already have an account? <a href="/users/login">Log in</a></p>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Preview Script -->
  <script>
    const profileImageInput = document.getElementById('imageUpload');
    const imagePreview = document.getElementById('imagePreview');

    profileImageInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          imagePreview.style.backgroundImage = `url('${e.target.result}')`;
        };
        reader.readAsDataURL(file);
      }
    });
  </script>

  <!-- Bootstrap Validation Script -->
  <script>
    (() => {
      'use strict';
      const form = document.getElementById('signupForm');
      form.addEventListener('submit', function (e) {
        if (!form.checkValidity()) {
          e.preventDefault();
          e.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    })();
  </script>
</body>
